{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "NYQST Workflow",
  "type": "object",
  "required": [
    "contract_version",
    "workflow_id",
    "project_id",
    "name",
    "version",
    "nodes",
    "edges",
    "triggers"
  ],
  "properties": {
    "contract_version": {
      "type": "string",
      "const": "1.0.0"
    },
    "workflow_id": {
      "type": "string"
    },
    "project_id": {
      "type": "string"
    },
    "name": {
      "type": "string"
    },
    "version": {
      "type": "integer",
      "minimum": 1
    },
    "nodes": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Node"
      }
    },
    "edges": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Edge"
      }
    },
    "triggers": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Trigger"
      }
    }
  },
  "$defs": {
    "Node": {
      "type": "object",
      "required": [
        "node_id",
        "type"
      ],
      "properties": {
        "node_id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "TRIGGER",
            "ACTION",
            "CONDITION"
          ]
        },
        "op": {
          "type": "string",
          "description": "e.g. RUN_APP, INGEST_BUNDLE, RUN_VALIDATION, NOTIFY"
        },
        "config": {
          "type": "object"
        }
      }
    },
    "Edge": {
      "type": "object",
      "required": [
        "from",
        "to"
      ],
      "properties": {
        "from": {
          "type": "string"
        },
        "to": {
          "type": "string"
        },
        "condition": {
          "type": "string"
        }
      }
    },
    "Trigger": {
      "type": "object",
      "required": [
        "trigger_type"
      ],
      "properties": {
        "trigger_type": {
          "type": "string",
          "enum": [
            "MANUAL",
            "SCHEDULE",
            "EVENT"
          ]
        },
        "schedule_cron": {
          "type": "string"
        },
        "event_type": {
          "type": "string"
        },
        "enabled": {
          "type": "boolean",
          "default": true
        }
      }
    }
  }
}