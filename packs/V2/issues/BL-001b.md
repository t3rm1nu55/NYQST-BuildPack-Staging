# BL-001b — Implement planner node with deterministic PlanTask IDs and minimal heuristics

- Type: **task**
- Milestone: `M1-W0`
- Repo alignment: **missing**
- Labels: `backend`, `langgraph`
- Depends on: `BL-001a`

## Problem

Without a stable planner, fan-out cannot be reliable and UI cannot track tasks over time.

## Proposed solution

Implement a `planner()` node that:
- Generates 3–7 tasks (bounded) with stable IDs (e.g., `t1`, `t2` or UUIDv7) and explicit dependencies.
- Uses a prompt template that requests structured JSON output matching `PlanSet`.
- Applies guardrails: dedupe near-duplicate tasks, cap recursion, ensure at least 1 synthesis task.

Keep heuristics simple in Wave 0; richer prompting is BL-012.

## Acceptance criteria

- Planner returns a valid PlanSet under normal prompts; invalid JSON is retried with a repair prompt.
- Task IDs remain stable within a run and appear in events.

## Test plan

- Unit: prompt → parse PlanSet; malformed output triggers repair path.
