# BL-001 — Extend ResearchAssistantGraph to planner → fan-out workers → synthesize (orchestrated research)

- Type: **story**
- Milestone: `M1-W0`
- Repo alignment: **missing**
- Labels: `backend`, `langgraph`, `wave:0`
- Depends on: `EPIC-W0`, `P0-001`, `P0-002`

## Problem

Current research graph is a single tool loop. Spec requires: planner produces a plan, workers execute tasks in parallel (Send), synthesis combines outputs into a shared data brief and report draft.

## Proposed solution

Refactor/extend `src/intelli/agents/graphs/research_assistant.py` into an orchestrated LangGraph:
- **planner** node: takes user intent + context, outputs PlanSet (tasks + tool preferences).
- **dispatch** node: converts PlanSet tasks into `Send(worker, task)` messages.
- **worker** node/subgraph: wraps the existing `create_react_agent()` tool-using agent to execute a single task and returns structured `TaskResult` (summary, evidence refs, citations).
- **fan-in synth** node: merges TaskResults into a `DataBrief` object (facts, assumptions, open questions, citations).
- **generator** node: produces a draft deliverable (report first) and emits report preview deltas.

Keep the existing AI SDK streaming contract: text chunks for assistant prose, `data` chunks for structured outputs (sources, plan updates, report deltas).

## Repo touchpoints

- `src/intelli/agents/graphs/research_assistant.py`
- `src/intelli/agents/adapters/__init__.py`
- `src/intelli/agents/tools/research_tools.py`

## Spec / reference pointers

- reference/archive/plans/BACKLOG.md (BL-001)
- reference/NYQST_Platform_Production_Intelligence_Build_Guide_v5.md (Build Sequence, Wave 0)

## Acceptance criteria

- Graph executes at least 3 tasks in parallel for a representative research prompt and completes with a synthesized result.
- Each worker task produces a structured TaskResult object including references to evidence artifacts (or placeholder IDs until EntityService is built).
- Graph supports cancellation/timeouts per task (basic guardrails).
- No regression to existing single-turn chat; multi-turn still works.

## Test plan

- Integration: run the graph with a fixed prompt; assert planner emits tasks; workers run; synth produces DataBrief.
- Unit: planner output schema validated; worker result schema validated; synth merge logic deterministic.

## Notes

Design goal: wrap existing `create_react_agent()` as the worker so we don’t throw away the working tool loop.
