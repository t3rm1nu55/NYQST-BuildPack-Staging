# BL-013 — Deepen Docs/Notebooks integration into research runs (selected notebook as context)

- Type: **story**
- Milestone: `M3-W2`
- Repo alignment: **partial**
- Labels: `backend`, `frontend`, `docs`, `wave:2`
- Depends on: `BL-003`, `BL-011`

## Problem

UI passes `pointer_id` and `manifest_sha256`, but the graph/tools do not yet use that selection to scope retrieval and context. Users need NotebookLM-style behaviour: ask within notebook context, cite notebook docs, and reuse extracted notes.

## Proposed solution

Implement notebook-scoped context:
- Backend: when `pointer_id`/`manifest_sha256` are provided, resolve the notebook manifest and restrict retrieval tools to those document hashes.
- Add `search_notebook_docs(query, notebook_id)` tool that filters by manifest members.
- Add a 'notebook notes' store (simple markdown notes linked to notebook) that can be retrieved as context.
- UI: surface "Notebook context active" badge and allow toggling notebook scope on/off.

## Repo touchpoints

- `src/intelli/api/v1/agent.py`
- `src/intelli/agents/graphs/research_assistant.py`
- `ui/src/pages/ResearchPage.tsx`
- `ui/src/pages/NotebookPage.tsx`

## Spec / reference pointers

- reference/archive/plans/BACKLOG.md (BL-013)

## Acceptance criteria

- When a notebook is selected, retrieval results come only from that notebook’s documents (unless user explicitly requests web).
- Citations can reference notebook documents and open the correct PDF/page in the viewer.
- Notebook notes are searchable and can be included in context.

## Test plan

- Integration: create two notebooks; ensure notebook-scoped search does not leak docs across notebooks.
- E2E: select notebook → ask question → sources show only notebook docs.
