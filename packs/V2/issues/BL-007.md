# BL-007 — PlanSet persistence and API: store plan state and expose to UI

- Type: **story**
- Milestone: `M2-W1`
- Repo alignment: **missing**
- Labels: `backend`, `runs`, `wave:1`
- Depends on: `BL-001b`, `BL-002a`

## Problem

PlanViewer needs a stable, queryable plan state, not just ephemeral events. Repo does not persist plan sets.

## Proposed solution

Add PlanSet storage:
- Option A (fast): store `plan_set` JSONB on `runs` table (and keep history via run_events).
- Option B (clean): new `plan_sets` table keyed by `run_id` with version + updated_at.

Add API:
- `GET /api/v1/runs/{run_id}/plan` returns latest PlanSet
- `PATCH /api/v1/runs/{run_id}/plan` for internal updates (graph only)

## Acceptance criteria

- PlanSet is retrievable for any run after planner completes.
- Updates are versioned and monotonic; UI can rehydrate from API on refresh.

## Test plan

- Integration: create run → planner → plan API returns expected structure.
