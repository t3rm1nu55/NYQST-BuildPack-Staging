# BL-012 â€” Planner prompt library + heuristics (quality improvements)

- Type: **story**
- Milestone: `M3-W2`
- Repo alignment: **missing**
- Labels: `backend`, `prompts`, `wave:2`
- Depends on: `BL-001b`, `EPIC-OBS`

## Problem

Wave 0 planner is intentionally minimal. For production, planning quality needs reusable prompt templates, better decomposition, tool selection hints, and guardrails against over-planning/under-planning.

## Proposed solution

Build a planner prompt library:
- Centralize prompts in `src/intelli/prompts/` with versioning.
- Add heuristics: cap tasks, enforce deliverable structure, require citations for factual claims, ensure at least one verification task.
- Add optional 'reflect and revise plan' step if confidence is low or tasks are missing key dimensions.

Add eval fixtures to measure plan quality.

## Repo touchpoints

- `src/intelli/prompts/* (new)`
- `tests/evals/*`

## Spec / reference pointers

- reference/archive/plans/BACKLOG.md (BL-012)

## Acceptance criteria

- Planner produces higher-quality plans on a golden prompt set (define rubric in docs).
- Prompt templates are versioned and testable; changes are reviewed like code.

## Test plan

- Eval: run planner against prompt fixtures; assert rubric score >= threshold.
