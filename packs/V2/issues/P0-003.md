# P0-003 â€” Add tenant_id to Run model and API filtering

- Type: **task**
- Milestone: `M0-P0`
- Repo alignment: **missing**
- Labels: `priority:P0`, `backend`, `multi-tenant`
- Depends on: `EPIC-P0`

## Problem

Run ledger is central to billing/metering and multi-tenant isolation, but `runs` currently have no `tenant_id` foreign key, making tenant-scoped queries and usage aggregation unreliable.

## Proposed solution

Add `tenant_id` to `Run` model + migration + API filtering.

Steps:
- DB: add `runs.tenant_id` (nullable initially), index it, and backfill from `session.tenant_id` or `conversation.tenant_id` where possible.
- App: require `tenant_id` for new runs; enforce tenant scoping in repositories and endpoints.
- Update any aggregations/usage records to use tenant_id.

## Repo touchpoints

- `src/intelli/db/models/runs.py`
- `src/intelli/repositories/runs.py`
- `src/intelli/api/v1/runs.py`
- `migrations/versions/*`

## Spec / reference pointers

- reference/NYQST_Platform_Production_Intelligence_Build_Guide_v5.md (P0-3)

## Acceptance criteria

- All new runs have `tenant_id` set and validated.
- Run list/read endpoints enforce tenant scoping.
- Backfill migration fills tenant_id for existing runs in dev DB fixtures.

## Test plan

- Integration: create run in tenant A cannot be read by tenant B.
- Migration test: backfill populates expected values for fixture rows.
