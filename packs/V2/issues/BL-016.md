# BL-016 — Entity + citation substrate (DB + APIs) and provenance enforcement

- Type: **story**
- Milestone: `M3-W2`
- Repo alignment: **missing**
- Labels: `backend`, `frontend`, `provenance`, `wave:2`
- Depends on: `BL-011`, `BL-015`, `P0-003`

## Problem

Provenance is non-negotiable: tool outputs, extracted snippets, and citations must be stored immutably and referenced consistently across reports, decisions, and dashboards. Repo lacks entity/citation tables and APIs.

## Proposed solution

Implement entity/citation substrate:
- DB: add `entities` table (content-addressed, points to artifact_sha256), and `citations` table (binds report span → entity_id + locator).
- APIs: CRUD/read for entities and citations; bulk fetch for UI.
- Enforce: report generation must emit citations; UI must display and allow review.
- Extend Artifact model with optional `entity_type`, `source_url`, `title`, `published_at`, `hashes` (if needed).

## Repo touchpoints

- `src/intelli/db/models/* (new entities/citations)`
- `src/intelli/api/v1/entities.py (new)`
- `ui/src/components/citations/* (new)`

## Spec / reference pointers

- reference/archive/plans/BACKLOG.md (BL-016)

## Acceptance criteria

- Entity can be created for a web page, PDF, or tool output, with stable ID and artifact linkage.
- Citations can be created/bound and retrieved for a report and displayed inline.
- Run events include `references_found` and `citations_bound` with entity/citation IDs.

## Test plan

- Integration: create entity + citation; fetch and verify joins and tenant scoping.
- Security: entity access respects workspace/project permissions.
