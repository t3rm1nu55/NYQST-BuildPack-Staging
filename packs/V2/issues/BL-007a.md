# BL-007a â€” Add PlanSet storage (runs.plan_set JSONB + migration) and repository helpers

- Type: **task**
- Milestone: `M2-W1`
- Repo alignment: **missing**
- Labels: `backend`, `db`
- Depends on: `BL-007`

## Problem

Need a place to persist plan sets with versioning and partial updates.

## Proposed solution

Implement Option A:
- Migration: add `runs.plan_set` JSONB nullable + `runs.plan_version` int default 0.
- Repository: `set_plan(run_id, plan_set, version)` with optimistic concurrency (version increments).

## Repo touchpoints

- `migrations/versions/*`
- `src/intelli/db/models/runs.py`
- `src/intelli/repositories/runs.py`

## Acceptance criteria

- Migration applies cleanly; repository can write and read plan_set.
- Concurrent plan updates do not overwrite silently (optimistic check).

## Test plan

- Integration test using Postgres transaction.
