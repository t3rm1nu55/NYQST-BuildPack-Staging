# BL-002 â€” Extend RunEvent contract + UI typing for plan/report/citation events

- Type: **story**
- Milestone: `M1-W0`
- Repo alignment: **missing**
- Labels: `backend`, `frontend`, `runs`, `wave:0`
- Depends on: `EPIC-W0`, `P0-002`

## Problem

Run ledger currently focuses on operational debug events. Spec requires user-facing events to drive PlanViewer, ReportPanel preview, and citation workflows.

## Proposed solution

Extend `RunEventType` + payload schemas to include:
- Plan lifecycle: `plan_created`, `plan_updated`, `plan_task_status_changed`
- Report preview: `report_preview_started`, `report_preview_delta`, `report_preview_completed`
- Citations: `references_found`, `citations_bound`, `citations_updated`
- Deliverables: `artifact_created`, `deliverable_ready`

Provide a TS discriminated union + zod validators in UI (new `ui/src/types/run-events.ts`), and update `RunTimeline` to render these events.

## Repo touchpoints

- `src/intelli/db/models/runs.py`
- `src/intelli/api/v1/streams.py`
- `ui/src/hooks/use-sse.ts`
- `ui/src/components/runs/RunTimeline.tsx`
- `ui/src/types/* (new)`

## Spec / reference pointers

- reference/archive/plans/BACKLOG.md (BL-002)

## Acceptance criteria

- Backend can emit the new event types and stores them in run_events with validated payload schema.
- UI can parse and display plan/report/citation events; unknown events fall back to generic renderer.
- SSE reconnection logic is improved (exponential backoff, resume by last sequence).

## Test plan

- Unit: payload validation for each new event type.
- E2E: a run emits plan and report preview events and they render in UI.
